<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Microsoft Volume Licence with KMS | Hyungjoon (Kevin) Koo</title> <meta name="author" content="Hyungjoon Koo"> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kevinkoo001.github.io/blog/2012/microsoft-volume-licence-with-kms/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Hyungjoon (Kevin) Koo</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Microsoft Volume Licence with KMS</h1> <p class="post-meta">December 4, 2012• kevinkoo001@gmail.com</p> <p class="post-tags"> <a href="/blog/2012"> <i class="fas fa-calendar fa-sm"></i> 2012 </a>   ·   <a href="/blog/tag/kms"> <i class="fas fa-hashtag fa-sm"></i> KMS</a>   <a href="/blog/tag/microsoft"> <i class="fas fa-hashtag fa-sm"></i> Microsoft</a>   <a href="/blog/tag/volume-license"> <i class="fas fa-hashtag fa-sm"></i> volume license</a>     ·   <a href="/blog/category/digital-forensic-amp-investigation"> <i class="fas fa-tag fa-sm"></i> Digital Forensic &amp; Investigation</a>   <a href="/blog/category/miscellaneous-stuff"> <i class="fas fa-tag fa-sm"></i> Miscellaneous Stuff</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>마이크로소프트는 Vista 버전부터 기관에서 복수 사용자를 인증하는 볼륨 라이선스를 MAK(Multiple Activation Keys) 이나 KMS(Key Management Server) 방식으로 제공한다. KMS를 통한 방식은 키 관리 서버와 주기적으로 통신하며 180일마다 재확인 절차를 거친다. 다만 MAK으로 인증한 제품의 경우 KMS로 재인증을 수행하지 않는다. 상세한 내용은 아래 링크를 참조하자.</p> <p>http://en.wikipedia.org/wiki/Volume_license_key http://www.microsoft.com/Licensing/existing-customers/product-activation.aspx</p> <p>오피스 2010 버전 정품을 KMS 방식으로 인증하는 방식을 한 번 지켜봤다.</p> <p><strong>1. 참조 파일과 레지스트리 위치 (Files and Registry keys for KMS)</strong></p> <p>키 인증에 관련된 파일은 아래 디렉토리와 레지스트리를 참조한다. The key management refers to the directory and the registry location below.</p> <p><strong>C:\Program Files\Common Files\Microsoft Shared\OfficeSoftwareProtectionPlatform</strong> <strong>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OfficeSoftwareProtectionPlatform</strong></p> <p><strong>2. 절차 (Procedures)</strong></p> <p>(1) 먼저 아래 디렉토리의 vbs를 수행하여 key server를 설정해 준다. First of all, key server should be identified by executing vbs in the directory below.</p> <p>C:\Program Files\Microsoft Office\Office14&gt;cscript ospp.vbs /sethst:[<em>key.management.server</em>]</p> <p>위 서버는 아래 registry 위치에 저장된다. 세션ID 또한 존재하는 것으로 보아 일정기간 동안 유효한 것으로 보인다. The key server value is stored in the specific registry location as follow. There is a ServiceSessionId, which makes using product valid.</p> <p><strong>HKLM\SOFTWARE\Microsoft\OfficeSoftwareProtectionPlatform\KeyManagementServiceName</strong> <strong>HKLM\SOFTWARE\Microsoft\OfficeSoftwareProtectionPlatform\ServiceSessionId</strong></p> <p>MS Office 2010이 사용하는 모듈 ID와 레지스트리 디렉토리는 다음과 같다. 해당 모듈을 찾을 수 있다면 MS Office 2010 사용자이거나 사용했던 적이 있다고 판단할 수 있다. The moduleID and its identifying location might inform investigators that the user has been used MS Office 2010.</p> <p>moduleID: ba38975c-7786-44bc-b924-147c77920328 <strong>HKLM\SOFTWARE\Microsoft\OfficeSoftwareProtectionPlatform\Plugins\Modules\ba38975c-7786-44bc-b924-147c77920328</strong> ** **(2) 아래 명령어를 통해 서버로부터 key를 activation한다. 아래 결과는 일부를 변조한 것이다. The script activates the key from the KMS server. Note that the result has been altered for security reasons.</p> <p>C:\Program Files\Microsoft Office\Office14&gt;cscript ospp.vbs /act Microsoft (R) Windows Script Host 버전 5.7 Copyright (C) Microsoft Corporation 1996-2001. All rights reserved.</p> <h2 id="processing">—Processing————————–</h2> <p>Installed product key detected - attempting to activate the following product: <strong>* ID: **</strong>7360-8c5f-417c-9d61-816<strong>**</strong>e0c LICENSE NAME: Office 14, OfficeProPlus-KMS_Client edition LICENSE DESCRIPTION: Office 14, VOLUME_KMSCLIENT channel Last 5 characters of installed product key: J3AT1</p> <product activation="" successful=""> --------------------------------------- --------------------------------------- ---Exiting----------------------------- **3. 흔적 (The artifacts)** 해당 스크립트가 실행되는 동안 시스템의 변화를 살펴봤다. (1) **이벤트뷰어 (Event viewer)**에서 다음과 같은 정보를 확인할 수 있었다. 하나는 클라이언트에서 활성화 요청을 하고 다른 하나는 서버에서 활성과 결과를 보여준다. The event viewer recorded an activation results: one for request from client, and the other for response from KMS. The client has sent an activation request to the key management service machine. Info: 0x00000000, 0x00000000, _key.management.server:_1688, .......-b604-4b8c-9a48-99d4348fcf37, 2012/12/04 07:06, 0, 2, 972, 6f345b60-8a5c-427c-....-836a982589dc, 5 The client has processed an activation response from the key management service machine. Info: 0x00000000, 0x00000000, 1, 0, 10, 120, 10080, 2012/12/04 07:06 KMS 서버는 주로 1688 포트를 사용하고 있으며, 외부에서 접근할 수 있도록 설정되어 있을 경우 어떻게 될까 궁금해서 시도해 봤으나 포트가 닫힌 탓인지 product key가 맞지 않아 아래 에러 코드와 함께 불가했다. The KMS server use port 1688/tcp. I gave a try to switch a different server, but failed for some reasons with errors. ERROR CODE: 0xC004F074 ERROR DESCRIPTION: The Software Licensing Service reported that the computer cou ld not be activated. No Key Management Service (KMS) could be contacted. Please see the Application Event Log for additional information. To view the activation event history run: cscript ospp.vbs /dhistorykms 수 분 후 활성화가 완료되면 아래와 같이 상태 체크를 하게 된다. In several minutes, the service checked the licensing status. The Software Protection service has completed licensing status check. Application Id=59a52881-a989-479d-af46-f275c6370663 Licensing Status= 1: 191301d3-..-..-b0c7-d7..9e3, 1, 0 [(0 [0xC004F014, 0, 0], [(?)(?)(?)(?)(?)(?)])(1 )(2 )] 2: 6f327760-..-..-9b61-83..70c, 1, 1 [(0 [0x00000000, 1, 0], [(?)(?)( 1 0x00000000 30 0 msft:rm/algorithm/volume/1.0 0x00000000 259192)(?)(?)(?)])(1 )(2 )] 3: fdf3ecb9-b56f-43b2-a9b8-1b48b6bae1a7, 1, 0 [(0 [0xC004F014, 0, 0], [(?)(?)(?)(?)(?)(?)])(1 )(2 )] Application 이벤트 ID 1003를 MS에서 직접 조회해 보았으나 예상대로 별 내용을 알려주지 않는다. The Microsoft does not give any information details about application event ID 1003, as expected. [![](http://2.bp.blogspot.com/-J15cbDz2OJA/UL3CIWhVrzI/AAAAAAAAAGU/AaqeMJYQ-j4/s1600/event1003.JPG)](http://2.bp.blogspot.com/-J15cbDz2OJA/UL3CIWhVrzI/AAAAAAAAAGU/AaqeMJYQ-j4/s1600/event1003.JPG) (2) **네트워크 패킷 (network packets)**은 요청시 260 바이트, 응답시 176 바이트의 stub 데이터를 포함하는데 아마 activation에 필요한 최소한의 데이터만 주고받는 것으로 보인다.  The network packets containing stub data for key activation was observed: 260 bytes for request and 176 bytes for response. [![](http://2.bp.blogspot.com/-JBhAmBsdk9c/UL3C6PTyEpI/AAAAAAAAAGc/mBDtZTsz5SY/s1600/npacket.JPG)](http://2.bp.blogspot.com/-JBhAmBsdk9c/UL3C6PTyEpI/AAAAAAAAAGc/mBDtZTsz5SY/s1600/npacket.JPG) (3) 시스템 변경사항 (system alteration) :스크립트 실행 당시 파일을 추적해 본 결과 흥미롭게도 C:\WINDOWS\AppPatch\sysmain.sdb라는 파일 접근, 오픈 등 40여 차례의 오퍼레이션이 일어났으나 어떤 작업인지는 알아낼 수 없었다. 키관리 서버에서 세션키를 수립하면 레지스트리 아래 위치에 저장되는 것으로 보인다. While executing the cscript, the operation was found to access and/or open the file, C:\WINDOWS\AppPatch\sysmain.sdb. The session key seems to be stored in particular registry location. **HKLM\SOFTWARE\Microsoft\OfficeSoftwareProtectionPlatform\Plugins\Modules\ba38975c-7786-44bc-b924-147c77920328** [![](http://1.bp.blogspot.com/-qllLxgRV_ws/UL3GgCauzyI/AAAAAAAAAGs/0dvpPEO_K8g/s1600/registry.JPG)](http://1.bp.blogspot.com/-qllLxgRV_ws/UL3GgCauzyI/AAAAAAAAAGs/0dvpPEO_K8g/s1600/registry.JPG) </product> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/code-reuse-attacks-and-defenses/">Code Reuse Attacks and Defenses</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2018/compiler-assisted-code-randomization/">Compiler-assisted Code Randomization</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2012/memory-forensics-with-volatility/">Memory Forensics with Volatility</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/cyber-grand-challenge-by-darpa/">Cyber Grand Challenge by DARPA</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/juggling-the-gadgets-instruction-displacement-to-mitigate-code-reuse-attack/">Juggling the Gadgets: Instruction Displacement to Mitigate Code Reuse Attack</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Hyungjoon Koo. Last updated: May 06, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>