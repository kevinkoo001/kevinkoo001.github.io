<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Demystifying Registry (1) | Hyungjoon (Kevin) Koo</title> <meta name="author" content="Hyungjoon Koo"> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kevinkoo001.github.io/blog/2012/demystifying-registry-1/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Hyungjoon (Kevin) Koo</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Demystifying Registry (1)</h1> <p class="post-meta">September 20, 2012• kevinkoo001@gmail.com</p> <p class="post-tags"> <a href="/blog/2012"> <i class="fas fa-calendar fa-sm"></i> 2012 </a>   ·   <a href="/blog/tag/digital-forensic"> <i class="fas fa-hashtag fa-sm"></i> digital forensic</a>   <a href="/blog/tag/registry"> <i class="fas fa-hashtag fa-sm"></i> registry</a>     ·   <a href="/blog/category/digital-forensic-amp-investigation"> <i class="fas fa-tag fa-sm"></i> Digital Forensic &amp; Investigation</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Windows 환경에서 수많은 정보의 보고인 Registry를 하나씩 살펴보자.</p> <p><strong>1. dd를 이용한 HDD 덤프 (Dumping HDD with dd)</strong></p> <p>집에 있던 무척 오래된 8GB짜리 고물 하드디스크가 있길래 덤프해 봤다. I dumped the image of old hard drive with the size of 8GB at home.</p> <p>D:\Tools\Digital Forensic\Dump\fau\FAU.x86&gt;dd.exe if=\.\G: of=C:\Temp\winxp.img conv=noerror –localwrt Statistics for logical volume \?\Volume{fa049b8f-018b-11e2-8062-005056c00008}<br> 0x082832000 bytes available 0x082832000 bytes free 0x214b0000 bytes total Volume Name:    \?\Volume{fa049b8f-018b-11e2-8062-005056c00008} Volume Label:   KOO Mount Points: G:<br> Drive Type:             Fixed Volume Serial Number:           1c62-13ee Maximum Component Length:       255</p> <p>Volume Characteristics: File system preserves case File system supports Unicode file names File System:            FAT32 Mounted:                Yes Clustered:              No Volume Extents: Disk Number:     1 Starting Offset: 0x0000000000007e00 Extent Length:   0x0000000201cbb200</p> <p>Copying \.\G: to C:\Temp\winxp.img Output: C:\Temp\winxp.img 8620061184 bytes 8220+1 records in 8220+1 records out 8620061184 bytes written</p> <p>Succeeded!</p> <p>이제 X-Ways Forensics 도구를 이용해 Registry를 추출해 보자.</p> <p><a href="http://2.bp.blogspot.com/-71QFlomS27o/UFng3P4NxFI/AAAAAAAAAFA/kFo8ZTrHk2g/s1600/regfiles.jpg" rel="external nofollow noopener" target="_blank"><img src="http://2.bp.blogspot.com/-71QFlomS27o/UFng3P4NxFI/AAAAAAAAAFA/kFo8ZTrHk2g/s1600/regfiles.jpg" alt=""></a></p> <p><strong>2. Registry 알아보기</strong> ** <strong>**(1) 데이터 유형 목록 (Listing of Registry value data types)</strong> <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms724884(v=vs.85).aspx" rel="external nofollow noopener" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/ms724884(v=vs.85).aspx</a></p> <table> <tbody> <tr> Value Type </tr> <tr> <td> REG_BINARY **(3)** </td> <td> 이진 데이터 </td> </tr> <tr> <td> REG_DWORD **(4)** </td> <td> 32비트 숫자 </td> </tr> <tr> <td> REG_DWORD_LITTLE_ENDIAN **(4)** </td> <td> 32bit 숫자 (little-endian format) </td> </tr> <tr> <td> REG_DWORD_BIG_ENDIAN **(5)** </td> <td> 32비트 숫자 (big-endian format) </td> </tr> <tr> <td> REG_EXPAND_SZ **(2)** </td> <td> Null로 끝나는 가변 데이터 문자열로 환경변수 참조 ex) "%PATH%" **ExpandEnvironmentStrings** 함수로 호출 </td> </tr> <tr> <td> REG_LINK **(6)** </td> <td> Null로 끝나는 Unicode 문자열로 symbolic link 경로 전용 REG_OPTION_CREATE_LINK를 이용한 **RegCreateKeyEx** 함수 호출 </td> </tr> <tr> <td> REG_MULTI_SZ **(7)** </td> <td> Null, 빈 문자 (\0)로 끝나는 일련의 문자열 ex) _String1_\0_String2_\0_String3_\0_LastString_\0\0 첫 번째 \0은 첫 번째 문자열 종료, 중간 \0은 각 문자열, 마지막 \0은 sequence 종료를 의미함 </td> </tr> <tr> <td> REG_NONE **(0)** </td> <td> 정의되어 있지 않음 </td> </tr> <tr> <td> REG_SZ **(1)** </td> <td> Null로 끝나는 문자열. Unicode나 ANSI 문자임 </td> </tr> </tbody> </table> <p><strong>(2) Registry 경로와 파일 (Registry Paths and Files)</strong></p> <p>Registry는 Hive 구조로 되어 있으며 아래 링크에 잘 설명되어 있으니 참조하자. <a href="http://technet.microsoft.com/en-us/library/cc750583.aspx" rel="external nofollow noopener" target="_blank">http://technet.microsoft.com/en-us/library/cc750583.aspx</a></p> <p>키는 다음 6개로 구성된다. HKEY_CLASSES_ROOT, HKEY_CURRENT_USER, HKEY_LOCAL_MACHINE, HKEY_USERS, HKEY_CURRENT_CONFIG, HKEY_DYN_DATA</p> <table> <tbody> <tr> Key 설명 </tr> <tr> <td> HKEY_CLASSES_ROOT </td> <td> HKEY_LOCAL_MACHINE\SOFTWARE\Classes의 Symbolic Link </td> </tr> <tr> <td> HKEY_CURRENT_USER </td> <td> HKEY_USERS 사용자 프로파일 Hive 하위 키 Symbolic link </td> </tr> <tr> <td> HKEY_LOCAL_MACHINE </td> <td> 물리적 hive는 존재하지 않으며 hive 구조의 다른 키를 보유함 </td> </tr> <tr> <td> HKEY_USERS </td> <td> 로그온 계정의 사용자 프로파일 hive를 담고 있는 장소 </td> </tr> <tr> <td> HKEY_CURRENT_CONFIG </td> <td> 현재 하드웨어 정보를 가지고 있는 키 Symbolic link (HKEY_LOCAL_MACHINE \SYSTEM CurrentControlSet\Control\IDConfigDB\Hardware Profiles 하위) </td> </tr> <tr> <td> HKEY_DYN_DATA </td> <td> 데이터 탐색 성능을 위한 장소이며 물리적 hive는 존재하지 않음 </td> </tr> </tbody> </table> <p>레지스트리는 크게 6개의 물리적 파일과 2개의 휘발성 파일이 있다. There are six physical hive files in hard disk and two volatile files in memory.</p> <table> <tbody> <tr> Registry Path File Path </tr> <tr> <td> HKLM\System </td> <td> %WINDIR%system32\config\SYSTEM </td> </tr> <tr> <td> HKLM\SAM </td> <td> %WINDIR%system32\config\SAM </td> </tr> <tr> <td> HKLM\Security </td> <td> %WINDIR%system32\config\SECURITY </td> </tr> <tr> <td> HKLM\Software </td> <td> %WINDIR%system32\config\SOFTWARE </td> </tr> <tr> <td> HKLM\Hardware </td> <td> 휘발성 Hive </td> </tr> <tr> <td> HKLM\System\Clone </td> <td> 휘발성 Hive </td> </tr> <tr> <td> HKEY_USERS\User SID </td> <td> 사용자 Profile (NTUSER.DAT) "Document and Settings\User" (WinXP), "Users\User" (Vista 이후) </td> </tr> <tr> <td> HKEY_USERS\Default </td> <td> %WINDIR%system32\config\DEFAULT </td> </tr> </tbody> </table> <p><strong>(3) 하이브 구조 (Hive Structures)</strong></p> <p>Registry는 파일 시스템에서 블록단위와 마찬가지로 논리적인 Hive 구조를 가지고 있다. Registry의 블록 크기는 4,096바이트(4KB)이며 새로운 데이터가 Hive에 추가될 때 block으로 증가한다. Hive는 다섯 가지의 데이터 유형으로 Key cell, Value cell, Subkey-list cell, Value-list cell, Security-descriptor cell로 구성된다. 특히 아래 보이는 kv, kn은 Signature다. (Little Endian)</p> <p>Registry has logical hive structure just like blick unit in file system. The size of the block is 4,096 Bytes (4KB). It increments by block size when adding new data. Hive structure has 5 different data types: Key cell, Value cell, Subkey-list cell, Value-list cell, Security-descriptor cell. See the signatures within the excerpt of a raw registry file.</p> <p><a href="http://4.bp.blogspot.com/-W0xX-7MFrWA/UFnj1jtKOqI/AAAAAAAAAFQ/Qp-Aqj7EjSY/s1600/registry_inside.jpg" rel="external nofollow noopener" target="_blank"><img src="http://4.bp.blogspot.com/-W0xX-7MFrWA/UFnj1jtKOqI/AAAAAAAAAFQ/Qp-Aqj7EjSY/s1600/registry_inside.jpg" alt=""></a></p> <table> <tbody> <tr> Cell Data Type </tr> <tr> <td> Key cell </td> <td> 레지스트리 키를 저장하고 있으며 키 노드라고도 함 * Signature: 키-kn, kl-심볼릭 링크 * 키가 최종 업데이트된 timestamp (LastWrite) </td> </tr> <tr> <td> Value cell </td> <td> 키값과 데이터를 저장하는 셀 *  Signature : kv * 유형: 상단 레지스트리 유형 참조 (e.g., REG_DWORD, REG_BINARY), * 값 이름 * 값의 데이터를 담고 있는 셀 인덱스 </td> </tr> <tr> <td> Subkey-list cell </td> <td> 키 셀을 가리키는 일련의 인덱스로 구성 </td> </tr> <tr> <td> Value-list cell </td> <td> 값 셀을 가리키는 일련의 인덱스로 구성 </td> </tr> <tr> <td> Security-descriptor cell </td> <td> 보안 식별자를 가지고 있는 셀 *  Signature: ks </td> </tr> </tbody> </table> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2018/compiler-assisted-code-randomization/">Compiler-assisted Code Randomization</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/cyber-grand-challenge-by-darpa/">Cyber Grand Challenge by DARPA</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2012/memory-forensics-with-volatility/">Memory Forensics with Volatility</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/code-reuse-attacks-and-defenses/">Code Reuse Attacks and Defenses</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/dynamic-linking-in-elf/">Dynamic Linking in ELF</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Hyungjoon Koo. Last updated: August 25, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>