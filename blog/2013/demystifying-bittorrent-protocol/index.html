<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Demystifying BitTorrent Protocol | Hyungjoon (Kevin) Koo</title> <meta name="author" content="Hyungjoon Koo"> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kevinkoo001.github.io/blog/2013/demystifying-bittorrent-protocol/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Hyungjoon (Kevin) Koo</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Demystifying BitTorrent Protocol</h1> <p class="post-meta">March 25, 2013• kevinkoo001@gmail.com</p> <p class="post-tags"> <a href="/blog/2013"> <i class="fas fa-calendar fa-sm"></i> 2013 </a>   ·   <a href="/blog/tag/bittorrent"> <i class="fas fa-hashtag fa-sm"></i> BitTorrent</a>   <a href="/blog/tag/protocol"> <i class="fas fa-hashtag fa-sm"></i> Protocol</a>   <a href="/blog/tag/torrent"> <i class="fas fa-hashtag fa-sm"></i> Torrent</a>     ·   <a href="/blog/category/miscellaneous-stuff"> <i class="fas fa-tag fa-sm"></i> Miscellaneous Stuff</a>   <a href="/blog/category/network-security"> <i class="fas fa-tag fa-sm"></i> Network Security</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>BitTorrent는 오늘날 개별 파일 공유에 가장 많이 사용하는 대표적인 프로토콜이다. 또한 저작권 측면에서 보면 2010년 이래에 20만 명 이상이 저작권으로 고소당하기도 했던 장본인이기도 하다. 2001년 Bram이라는 친구가 처음 만든 이 프로토콜에 대해 기술적으로 한 번 살펴보자. F-Insight에서 발표한 내용이기도 하니 다음 자료를 참고하자.( <a href="http://dandylife.net/blog/wp-content/uploads/2013/07/BitTorrent-Protocol.pdf" rel="external nofollow noopener" target="_blank">BitTorrent-Protocol</a> )</p> <p>Today the BitTorrent protocol is widely used for file sharing privately. Created by Bram Cohen in 2001, it is estimated that there are 150 million active BitTorrent users, approximately 250 million potential ones as of Jan. 2011. You may want to refer to the material which I presented in “<a href="http://forensicinsight.org/" rel="external nofollow noopener" target="_blank">Forensic Insight Seminar</a>”.</p> <p><strong>1. 주요용어 (Terminology)</strong> ** **(Ref) <a href="http://www.bittorrent.com/intl/ko/help/faq/concepts" rel="external nofollow noopener" target="_blank">http://www.bittorrent.com/intl/ko/help/faq/concepts</a></p> <p><strong>block</strong> a piece of a file when distributed via BitTorrent <strong>peer</strong> one of a group of clients downloading the same file <strong>leech </strong>a peer that is downloading while uploading very little, or nothing at all. a.k.a leecher <strong>scrape</strong> a request to the tracker for information about the statistics of the torrent <strong>seed</strong> a complete copy of the file being made available for download <strong>seeder</strong> a peer that is done downloading a file and is now just making it available to others. <strong>torrent </strong>the instance of a file or group of files being distributed via BitTorrent <strong>swarm</strong> a group of seeds and peers sharing the same torrent <strong>tracker</strong> a server that keeps track of the peers and seeds in a swarm</p> <p><strong>블록</strong> BitTorrent 를 통해 배포하는 파일 조각</p> <p><strong>피어</strong> 동일한 파일을 다운로드하는 클라이언트 그룹원</p> <p><strong>리치</strong> 업로드는 거의 하지 않으며 주로 다운로드하는 피어</p> <p><strong>스크레이프</strong> torrent 통계 관련 정보를 트래커에게 질의</p> <p><strong>시드</strong> 다운로드할 수 있는 전체 복사본 파일</p> <p><strong>시더</strong> 다운로드를 완료한 피어 또는 다른 이에게 파일을 공유할 수 있는 피어</p> <p><strong>토렌트</strong> BitTorrent를 통해 배포하는 파일 인스턴스</p> <p><strong>스웜</strong> 동일한 토렌트를 공유하는 시드 그룹과 피어</p> <p><strong>트래커</strong> 스웜에서 피어나 시드를 찾는 서버</p> <p><strong>2. 프로토콜 명세 (Protocol Specification)</strong></p> <p>(1) <strong>Becoding (Binary Encoding)</strong>: A way to specify the data in a terse format</p> <ul> <li>문자열, 숫자, 리스트, 사전을 아래와 같이 정의해서 간단히 표현한다.</li> </ul> <p><a href="http://1.bp.blogspot.com/-hhywGIOWrfs/UU_hynrg3oI/AAAAAAAAAM8/7HuWyJuVDB4/s1600/bencoding.jpg" rel="external nofollow noopener" target="_blank"><img src="http://1.bp.blogspot.com/-hhywGIOWrfs/UU_hynrg3oI/AAAAAAAAAM8/7HuWyJuVDB4/s1600/bencoding.jpg" alt=""></a></p> <p>(2) <strong>Torrent File Structure</strong></p> <ul> <li> <p>토렌트 파일구조는 아래와 같은데 크게 Info 영역과 Announce 부분으로 나뉜다.</p> </li> <li> <p>Info에서 파일 전체 길이, 이름, 조각길이와 각 조각의 20바이트 SHA1 값으로 구성된다.</p> </li> <li> <p>길이 조각(length piece)은 파일 크기에 따라 다양하나 256KB를 기본으로 사용한다.</p> </li> <li> <p>참고로 Torrent 파일을 직접 편집할 수 있는 웹사이트도 존재한다. (<a href="http://torrenteditor.com/" rel="external nofollow noopener" target="_blank">http://torrenteditor.com</a>)</p> </li> </ul> <p><a href="http://3.bp.blogspot.com/-ZVxKbsKz-fo/UU_h1D6Ho7I/AAAAAAAAANQ/Mv-yaZncxYI/s1600/metainfo.jpg" rel="external nofollow noopener" target="_blank"><img src="http://3.bp.blogspot.com/-ZVxKbsKz-fo/UU_h1D6Ho7I/AAAAAAAAANQ/Mv-yaZncxYI/s1600/metainfo.jpg" alt=""></a></p> <table cellpadding="0" align="center" cellspacing="0"> <tbody> <tr> <td>[![](http://3.bp.blogspot.com/-GMK__S4XfJQ/UU_h1i98U-I/AAAAAAAAANk/hkhnCm1PEKY/s1600/metainfo_eg.jpg)](http://3.bp.blogspot.com/-GMK__S4XfJQ/UU_h1i98U-I/AAAAAAAAANk/hkhnCm1PEKY/s1600/metainfo_eg.jpg) </td> </tr> <tr> <td>An example of torrent file for each part - d for dictionaries, l for listings, i for integers, s for strings. </td> </tr> </tbody> </table> <p>(3) <strong>Tracker HTTP Protocol</strong></p> <ul> <li> <p>아래 표는 Tracker 서버의 Request 영역으로 가장 중요한 부분은 info_hash, peer_id, port, numwant 정보다.</p> </li> <li> <p>Port는 BitTorrent를 구현한 Application마다 다르므로 기본 포트가 다를 수 있다.</p> </li> <li> <p>기본적으로 tracker에게 piece가 있는 곳 정보를 50군데 제공받고 해당 peer에게 전송받기 시작한다.</p> </li> <li> <p>아래 그림에서 Tracker Handshaking을 완료하면 조각을 가진 peer가 소유여부(Have)를 알리고 요청(request)한다.</p> </li> </ul> <p><a href="http://4.bp.blogspot.com/-Oquw850FdR4/UU_h1zpBAiI/AAAAAAAAANw/an522JyxU4o/s1600/tracker_req.jpg" rel="external nofollow noopener" target="_blank"><img src="http://4.bp.blogspot.com/-Oquw850FdR4/UU_h1zpBAiI/AAAAAAAAANw/an522JyxU4o/s1600/tracker_req.jpg" alt=""></a></p> <p><a href="http://3.bp.blogspot.com/-NoCmp08RlvY/UU_h2DO51bI/AAAAAAAAAN0/DQlLFdwHwq8/s1600/tracker_req_resp.jpg" rel="external nofollow noopener" target="_blank"><img src="http://3.bp.blogspot.com/-NoCmp08RlvY/UU_h2DO51bI/AAAAAAAAAN0/DQlLFdwHwq8/s1600/tracker_req_resp.jpg" alt=""></a></p> <p><strong>3. 동작방식 (Operation)</strong></p> <p>(1) <strong>File Sharing Mechanism</strong></p> <ul> <li> <p>좌측의 Initial Seeder가 파일을 조각(piece)내고 torrent 파일에 위치정보를 포함하여 tracker로 알려준다.</p> </li> <li> <p>우측의 leecher는 해당 파일의 torrent 정보를 통해 tracker에게 요청하고 응답받은 후 패킷을 받는다.</p> </li> <li> <p>이 때 실제는 Performance Issue로 각 piece는 16KB의 sub-piece로 다시 쪼개어 한 번에 다섯 부분만 받는다.</p> </li> <li> <p>아래 그림에서 고양이 Leecher가 다운완료하면 새로운 Leecher인 닭이 또다시 양쪽에서 요청한다.</p> </li> </ul> <p><a href="http://1.bp.blogspot.com/-JfeWIGSv0yo/UU_h1PbyxVI/AAAAAAAAANM/3dioLtaHgWk/s1600/file_sharing_mechanism.jpg" rel="external nofollow noopener" target="_blank"><img src="http://1.bp.blogspot.com/-JfeWIGSv0yo/UU_h1PbyxVI/AAAAAAAAANM/3dioLtaHgWk/s1600/file_sharing_mechanism.jpg" alt=""></a></p> <p><a href="http://2.bp.blogspot.com/-Y-ujX6g9kOM/UU_h1LnFXwI/AAAAAAAAANU/1yawgZCA-7s/s1600/file_sharing_mechanism2.jpg" rel="external nofollow noopener" target="_blank"><img src="http://2.bp.blogspot.com/-Y-ujX6g9kOM/UU_h1LnFXwI/AAAAAAAAANU/1yawgZCA-7s/s1600/file_sharing_mechanism2.jpg" alt=""></a></p> <p>(2) <strong>조각 선택 알고리즘 (</strong><strong>Piece Selection Algorithms)</strong></p> <ul> <li> <p>Super Seeding (Initial Seeding Mode): Special Case A peer has nothing to trade initially, so it is Important to get a complete piece ASAP.This makes peer select a random piece of the file and download it.</p> </li> <li> <p>Strict Priority: First Priority This policy keeps the initial bitfield from each peer, and updates it with every “have” message.Then a peer downloads the pieces that appear least frequently in these peer bitfields.</p> </li> <li> <p>Rarest First → General rule BitTorrent determines the pieces that are most rare among your peers, and download those first.It ensures that the most commonly available pieces are left till the end to download.</p> </li> <li> <p>Endgame modeAs the completion time closes, bitTorrent requests all peers at the same time. If the requests seem to pend, then it would be cancelled immediately.</p> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2018/compiler-assisted-code-randomization/">Compiler-assisted Code Randomization</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/code-reuse-attacks-and-defenses/">Code Reuse Attacks and Defenses</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/cyber-grand-challenge-by-darpa/">Cyber Grand Challenge by DARPA</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/dynamic-linking-in-elf/">Dynamic Linking in ELF</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/juggling-the-gadgets-instruction-displacement-to-mitigate-code-reuse-attack/">Juggling the Gadgets: Instruction Displacement to Mitigate Code Reuse Attack</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Hyungjoon Koo. Last updated: November 07, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>